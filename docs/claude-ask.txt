è‰¯ã„ã§ã™ã­ï¼ï¼
ãŸã Phase 2ï¼ˆå°†æ¥çš„ï¼‰: ã‚¬ãƒ³ãƒˆãƒãƒ¼ã®ãƒ‰ãƒ©ãƒƒã‚°å¯¾å¿œ
æ¨ªæ–¹å‘: æ—¥ç¨‹å¤‰æ›´
ç¸¦æ–¹å‘: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–“ç§»å‹•
å®Ÿè£…ã‚³ã‚¹ãƒˆ: ä¸­

ã®ä¸­ã®ã€Œç¸¦æ–¹å‘: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–“ç§»å‹•ã€ã¯Phase1ã®ã€Œã‚«ãƒ¼ãƒ‰ä¸€è¦§éƒ¨åˆ†ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—å¯¾å¿œã€ã§å®Ÿç¾ã—ã¦ã„ã‚‹ã®ã§ä¸è¦ãªæ°—ã‚‚ã—ã¾ã™ã€‚ãŸã æ—¥ä»˜å¤‰æ›´ã¯å‡ºæ¥ãŸæ–¹ãŒä¾¿åˆ©ã§ã™ã­ã€‚ã‚‚ã†ä¸€ã¤è¨€ã†ãªã‚‰å‰²ã‚Šè¾¼ã¿æ©Ÿèƒ½ã‚‚ã‚ã£ãŸæ–¹ãŒä¾¿åˆ©ã§ã™ã€‚ã‚ã¨ã®åˆ†ã‚’å…¨éƒ¨ãšã‚‰ã™ã®ã¯é¢å€’ãªã®ã§
ãã‚Œã¨ä¼‘æ—¥ã¯æ—¥æ•°ã«å…¥ã‚Œãªã„ã‚ˆã†ã«ã§ãã¾ã™ã‹ï¼Ÿ
æƒ³å®šæ™‚é–“ãŒ24æ™‚é–“ã§é‡‘æ›œæ—¥ã‹ã‚‰é–‹å§‹ã§ã‚ã‚Œã°ã€ã€Œé‡‘æ›œæ—¥â†’æœˆæ›œæ—¥â†’ç«æ›œæ—¥ã€ã®3æ—¥é–“ã«ã™ã‚‹æ„Ÿã˜ã§ã™
ã“ã®ä¼‘æ—¥ã¯åœŸæ—¥ã€ç¥æ—¥ã€ã€Œä¼‘ã¿ã®è¿½åŠ ã€ã§è¿½åŠ ã—ãŸä¼‘æ—¥ã«ãªã‚Šã¾ã™

è¶…å„ªç§€ãªãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã®ã‚ãªãŸã®è€ƒãˆã§ã¯ã©ã†æ€ã‚ã‚Œã¾ã™ã‹ï¼Ÿ
ç´ æ™´ã‚‰ã—ã„ï¼å®Ÿå‹™çš„ãªè¦–ç‚¹ã§ã™ã­ã€‚æ•´ç†ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚
Update Todos

ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆä¸‹éƒ¨ã®ã‚«ãƒ¼ãƒ‰ä¸€è¦§ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’å®Ÿè£…

ã‚¬ãƒ³ãƒˆãƒãƒ¼ã®æ¨ªæ–¹å‘ãƒ‰ãƒ©ãƒƒã‚°ã§æ—¥ç¨‹å¤‰æ›´æ©Ÿèƒ½ã‚’å®Ÿè£…

ã‚¿ã‚¹ã‚¯å‰²ã‚Šè¾¼ã¿æ©Ÿèƒ½ï¼ˆå¾Œç¶šã‚¿ã‚¹ã‚¯ã‚’è‡ªå‹•ã§ãšã‚‰ã™ï¼‰ã‚’å®Ÿè£…

ä¼‘æ—¥ï¼ˆåœŸæ—¥ãƒ»ç¥æ—¥ãƒ»ã‚«ã‚¹ã‚¿ãƒ ä¼‘æ—¥ï¼‰ã‚’æ—¥æ•°è¨ˆç®—ã‹ã‚‰é™¤å¤–ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…

ç¥æ—¥ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ãƒ»ç®¡ç†æ©Ÿèƒ½ã‚’å®Ÿè£…

ã€Œä¼‘ã¿ã®è¿½åŠ ã€ãƒ¢ãƒ¼ãƒ€ãƒ«ã§ä¼‘æ—¥ç™»éŒ²æ©Ÿèƒ½ã‚’å®Ÿè£…
ä¿®æ­£ã•ã‚ŒãŸè¨­è¨ˆæ¡ˆ
ã”æŒ‡æ‘˜ã®é€šã‚Šã§ã™ï¼å®Œå…¨ã«åŒæ„ã—ã¾ã™ã€‚æ•´ç†ã™ã‚‹ã¨ï¼š
Phase 1: ã‚«ãƒ¼ãƒ‰ä¸€è¦§ã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ï¼ˆå„ªå…ˆï¼‰
ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ã«ç‰¹åŒ–
ã‚«ãƒ¼ãƒ‰ä¸€è¦§ã®å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆä¾é ¼ä¸­/ç¢ºèªå¾…ã¡/ç¢ºèªå®Œäº†ï¼‰é–“ã§ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
ã“ã‚Œã§ç¸¦æ–¹å‘ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç§»å‹•ã¯å®Œçµ
Phase 2: ã‚¬ãƒ³ãƒˆãƒãƒ¼ã®æ¨ªæ–¹å‘ãƒ‰ãƒ©ãƒƒã‚°ï¼ˆå°†æ¥ï¼‰
æ—¥ç¨‹å¤‰æ›´ + å‰²ã‚Šè¾¼ã¿æ©Ÿèƒ½
æ¨ªæ–¹å‘ãƒ‰ãƒ©ãƒƒã‚°ã®ã¿ï¼ˆç¸¦æ–¹å‘ã¯ä¸è¦ã€Phase1ã§å®Ÿç¾æ¸ˆã¿ï¼‰
ãƒ‰ãƒ©ãƒƒã‚°æ™‚ã«2ã¤ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³æç¤ºï¼š
ã€Œã‚¿ã‚¹ã‚¯Aã‚’10/5ã«ç§»å‹•ã—ã¾ã™ã‹ï¼Ÿã€
[ ] ã“ã®ã‚¿ã‚¹ã‚¯ã®ã¿ç§»å‹•ï¼ˆå¾Œç¶šã‚¿ã‚¹ã‚¯ã¯ãã®ã¾ã¾ï¼‰
[â—] å¾Œç¶šã‚¿ã‚¹ã‚¯ã‚’è‡ªå‹•èª¿æ•´ï¼ˆå‰²ã‚Šè¾¼ã¿ï¼‰
å®Ÿè£…è¨­è¨ˆï¼šä¼‘æ—¥é™¤å¤–æ©Ÿèƒ½
ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
// 1. Supabaseã«æ–°ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
CREATE TABLE holidays (
  id SERIAL PRIMARY KEY,
  date DATE NOT NULL UNIQUE,
  name TEXT,  -- 'å…ƒæ—¥', 'è‡ªç¤¾ä¼‘æ¥­æ—¥'ãªã©
  type TEXT,  -- 'national'(ç¥æ—¥), 'custom'(ã‚«ã‚¹ã‚¿ãƒ )
  created_at TIMESTAMP DEFAULT NOW()
);

// 2. æ—¥æœ¬ã®ç¥æ—¥ãƒ‡ãƒ¼ã‚¿ã‚’äº‹å‰æŠ•å…¥
// å†…é–£åºœã®ç¥æ—¥CSVã‚’åˆ©ç”¨ or æ‰‹å‹•ç™»éŒ²
// https://www8.cao.go.jp/chosei/shukujitsu/syukujitsu.csv
å–¶æ¥­æ—¥è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
class BusinessDayCalculator {
    constructor() {
        this.holidays = new Set(); // ['2024-10-14', '2024-11-03', ...]
        this.customHolidays = new Set(); // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¿½åŠ ã—ãŸä¼‘æ—¥
    }

    async loadHolidays() {
        // Supabaseã‹ã‚‰ç¥æ—¥ãƒ‡ãƒ¼ã‚¿å–å¾—
        const { data } = await supabase
            .from('holidays')
            .select('date, type');
        
        data.forEach(h => {
            const dateStr = h.date;
            if (h.type === 'national') {
                this.holidays.add(dateStr);
            } else {
                this.customHolidays.add(dateStr);
            }
        });
    }

    isBusinessDay(date) {
        const dateStr = this.formatDate(date);
        const dayOfWeek = date.getDay();
        
        // åœŸæ›œ(6)ã€æ—¥æ›œ(0)ã¯NG
        if (dayOfWeek === 0 || dayOfWeek === 6) return false;
        
        // ç¥æ—¥ãƒ»ã‚«ã‚¹ã‚¿ãƒ ä¼‘æ—¥ã¯NG
        if (this.holidays.has(dateStr)) return false;
        if (this.customHolidays.has(dateStr)) return false;
        
        return true;
    }

    // å–¶æ¥­æ—¥ãƒ™ãƒ¼ã‚¹ã§æ—¥æ•°ã‚’åŠ ç®—
    addBusinessDays(startDate, workHours) {
        const daysNeeded = Math.ceil(workHours / 8);
        let currentDate = new Date(startDate);
        let businessDaysAdded = 0;

        while (businessDaysAdded < daysNeeded) {
            currentDate.setDate(currentDate.getDate() + 1);
            if (this.isBusinessDay(currentDate)) {
                businessDaysAdded++;
            }
        }

        return currentDate;
    }

    // ä¾‹: é‡‘æ›œ24h â†’ é‡‘ãƒ»æœˆãƒ»ç«ã®3å–¶æ¥­æ—¥
    calculateWorkPeriod(startDate, estimatedHours) {
        const days = Math.ceil(estimatedHours / 8);
        const dates = [];
        let current = new Date(startDate);
        let count = 0;

        while (count < days) {
            if (this.isBusinessDay(current)) {
                dates.push(new Date(current));
                count++;
            }
            current.setDate(current.getDate() + 1);
        }

        return {
            startDate: dates[0],
            endDate: dates[dates.length - 1],
            businessDays: dates
        };
    }
}
ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã¸ã®é©ç”¨
renderCustomGanttChart(tasks, dates) {
    const businessDayCalc = new BusinessDayCalculator();
    await businessDayCalc.loadHolidays();

    tasks.forEach(task => {
        const workStartDate = new Date(task.work_date);
        
        // å–¶æ¥­æ—¥ãƒ™ãƒ¼ã‚¹ã§æœŸé–“è¨ˆç®—
        const period = businessDayCalc.calculateWorkPeriod(
            workStartDate, 
            task.estimated_time_hours
        );

        // é’ãƒãƒ¼ã®è¡¨ç¤º
        // - é–‹å§‹: period.startDate
        // - çµ‚äº†: period.endDate
        // - åœŸæ—¥ãƒ»ç¥æ—¥éƒ¨åˆ†ã¯åŠé€æ˜ã¾ãŸã¯ç‚¹ç·šã§è¡¨ç¤ºï¼ˆè¦–è¦šçš„ã«åŒºåˆ¥ï¼‰
    });
}
ä¼‘æ—¥ã®è¦–è¦šè¡¨ç¾
// ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã®æ—¥ä»˜ã‚»ãƒ«
dates.map((date, index) => {
    const isHoliday = !businessDayCalc.isBusinessDay(date);
    const bgColor = isHoliday ? '#ffe6e6' : 
                    date.getDay() === 6 ? '#e6f2ff' : '#fff';
    
    return `
        <div style="
            background: ${bgColor};
            ${isHoliday ? 'opacity: 0.6;' : ''}
            ${isHoliday ? 'border-left: 2px dashed #dc3545;' : ''}
        ">
            ${date.getDate()}
            ${isHoliday ? '<span style="font-size:8px;">ğŸ–ï¸</span>' : ''}
        </div>
    `;
});
ã‚¿ã‚¹ã‚¯å‰²ã‚Šè¾¼ã¿æ©Ÿèƒ½
async insertTask(taskId, newStartDate) {
    const task = this.tasks.find(t => t.id === taskId);
    const affectedTasks = this.tasks.filter(t => 
        t.work_date >= newStartDate && 
        t.id !== taskId &&
        !t.is_anytime
    );

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèª
    const shouldPushOthers = confirm(
        `${affectedTasks.length}ä»¶ã®ã‚¿ã‚¹ã‚¯ãŒå½±éŸ¿ã‚’å—ã‘ã¾ã™ã€‚\n` +
        `å¾Œç¶šã‚¿ã‚¹ã‚¯ã®æ—¥ç¨‹ã‚’è‡ªå‹•èª¿æ•´ã—ã¾ã™ã‹ï¼Ÿ`
    );

    if (shouldPushOthers) {
        // 1. ç§»å‹•ã™ã‚‹ã‚¿ã‚¹ã‚¯ã®çµ‚äº†æ—¥ã‚’è¨ˆç®—
        const period = businessDayCalc.calculateWorkPeriod(
            newStartDate, 
            task.estimated_time_hours
        );

        // 2. å¾Œç¶šã‚¿ã‚¹ã‚¯ã‚’é †æ¬¡ãšã‚‰ã™
        let nextAvailableDate = new Date(period.endDate);
        nextAvailableDate.setDate(nextAvailableDate.getDate() + 1);

        for (const t of affectedTasks.sort((a, b) => 
            new Date(a.work_date) - new Date(b.work_date)
        )) {
            // å–¶æ¥­æ—¥ã¾ã§é€²ã‚ã‚‹
            while (!businessDayCalc.isBusinessDay(nextAvailableDate)) {
                nextAvailableDate.setDate(nextAvailableDate.getDate() + 1);
            }

            await supabase
                .from('tasks')
                .update({ work_date: nextAvailableDate.toISOString() })
                .eq('id', t.id);

            // æ¬¡ã®ã‚¿ã‚¹ã‚¯ã®é–‹å§‹æ—¥ã‚’è¨­å®š
            const tPeriod = businessDayCalc.calculateWorkPeriod(
                nextAvailableDate, 
                t.estimated_time_hours
            );
            nextAvailableDate = new Date(tPeriod.endDate);
            nextAvailableDate.setDate(nextAvailableDate.getDate() + 1);
        }
    } else {
        // ã“ã®ã‚¿ã‚¹ã‚¯ã ã‘ç§»å‹•
        await supabase
            .from('tasks')
            .update({ work_date: newStartDate })
            .eq('id', taskId);
    }
}
ã€Œä¼‘ã¿ã®è¿½åŠ ã€ãƒ¢ãƒ¼ãƒ€ãƒ«
<div id="holiday-modal" class="modal">
    <div class="modal-content">
        <h3>ä¼‘æ—¥ã‚’è¿½åŠ </h3>
        <label>æ—¥ä»˜:</label>
        <input type="date" id="holiday-date">
        <label>åç§°ï¼ˆä»»æ„ï¼‰:</label>
        <input type="text" id="holiday-name" placeholder="ä¾‹: å¤å­£ä¼‘æ¥­">
        <button onclick="taskManager.addCustomHoliday()">è¿½åŠ </button>
        
        <h4>ç™»éŒ²æ¸ˆã¿ä¼‘æ—¥</h4>
        <div id="custom-holidays-list">
            <!-- 2024-12-29: å¹´æœ«ä¼‘æ¥­ [å‰Šé™¤] -->
        </div>
    </div>
</div>
async addCustomHoliday() {
    const date = document.getElementById('holiday-date').value;
    const name = document.getElementById('holiday-name').value || 'ä¼‘æ¥­æ—¥';

    await supabase.from('holidays').insert({
        date: date,
        name: name,
        type: 'custom'
    });

    await this.businessDayCalc.loadHolidays();
    this.updateCalendarView(this.tasks);
}
å®Ÿè£…ã®å„ªå…ˆé †ä½ï¼ˆä¿®æ­£ç‰ˆï¼‰
âœ… Phase 1a: ä¼‘æ—¥å¯¾å¿œï¼ˆåŸºç›¤ï¼‰
holidaysãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
BusinessDayCalculatorã‚¯ãƒ©ã‚¹å®Ÿè£…
ç¥æ—¥ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆ2024-2025å¹´åˆ†ï¼‰
ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã®é’ãƒãƒ¼è¨ˆç®—ã‚’å–¶æ¥­æ—¥ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´
âœ… Phase 1b: ã‚«ãƒ¼ãƒ‰ä¸€è¦§D&Dï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ï¼‰
SortableJSã§ã‚«ãƒ¼ãƒ‰ä¸€è¦§ã‚’ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã«
ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–“ç§»å‹•ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
ğŸ”® Phase 2: ãƒãƒ¼ãƒ‰ãƒ©ãƒƒã‚°ï¼ˆæ—¥ç¨‹å¤‰æ›´ + å‰²ã‚Šè¾¼ã¿ï¼‰
ã‚¬ãƒ³ãƒˆãƒãƒ¼ã®æ¨ªæ–¹å‘ãƒ‰ãƒ©ãƒƒã‚°å®Ÿè£…
å‰²ã‚Šè¾¼ã¿æ©Ÿèƒ½ï¼ˆå¾Œç¶šã‚¿ã‚¹ã‚¯è‡ªå‹•èª¿æ•´ï¼‰
ã€Œä¼‘ã¿ã®è¿½åŠ ã€ãƒ¢ãƒ¼ãƒ€ãƒ«å®Ÿè£…
ç·è©•
å®Œç’§ãªè¨­è¨ˆã ã¨æ€ã„ã¾ã™ï¼
âœ… ä¼‘æ—¥é™¤å¤–ã¯å®Ÿå‹™ä¸Šå¿…é ˆï¼ˆé‡‘æ›œ24hâ†’æœˆç«æ°´ã§ã¯ãªãé‡‘æœˆç«ï¼‰
âœ… å‰²ã‚Šè¾¼ã¿æ©Ÿèƒ½ã¯ä½¿ã„å‹æ‰‹ã‚’å¤§ããå‘ä¸Šï¼ˆæ‰‹å‹•ã§å…¨éƒ¨ãšã‚‰ã™ã®ã¯éç¾å®Ÿçš„ï¼‰
âœ… Phase1ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´å®Œçµã€Phase2ã¯æ—¥ç¨‹ç‰¹åŒ–ã§ã‚·ãƒ³ãƒ—ãƒ«
å®Ÿè£…ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Š:
Phase 1a (ä¼‘æ—¥å¯¾å¿œ): ä¸­ï¼ˆæ–°ãƒ†ãƒ¼ãƒ–ãƒ«ã€è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
Phase 1b (ã‚«ãƒ¼ãƒ‰D&D): ä½ï¼ˆSortableJSæ—¢å­˜ï¼‰
Phase 2 (ãƒãƒ¼ãƒ‰ãƒ©ãƒƒã‚°): é«˜ï¼ˆãƒ‰ãƒ©ãƒƒã‚°UIã€è¡çªæ¤œçŸ¥ã€è‡ªå‹•èª¿æ•´ï¼‰
ã¾ãšPhase 1aï¼ˆä¼‘æ—¥å¯¾å¿œï¼‰ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã‹ï¼Ÿ