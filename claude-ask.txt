● 事業者管理アプリ - 最新版仕様書

  📋 プロジェクト概要

  Supabase + Vercel サーバーレス完全移行版事業者管理アプリケーション

- 本番URL: https://jigyosyakanri2.vercel.app/
- リポジトリ: 

  🏗️ 技術スタック

  フロントエンド

  - HTML/CSS/JavaScript (Vanilla)
  - ホスティング: Vercel (サーバーレス)
  - 認証: Google OAuth 2.0
  - UI: カスタムドロップダウン、アコーディオンメニュー

  バックエンド・データベース

  - データベース: Supabase PostgreSQL
  - 認証: Supabase Auth (Google OAuth連携)
  - API: Supabase REST API
  - リアルタイム: Supabaseリアルタイム機能

  🗄️ データベース構造
backup_clients
キー: 定義なし
カラム:
id: integer
name: character varying
fiscal_month: integer
staff_id: integer
accounting_method: character varying
status: character varying
custom_tasks_by_year: jsonb
finalized_years: jsonb
created_at: timestamp with time zone
updated_at: timestamp with time zone

backup_default_tasks
キー: 定義なし
カラム:
id: integer
task_name: character varying
display_order: integer
is_active: boolean
created_at: timestamp with time zone
updated_at: timestamp with time zone

clients
主キー: id
外部キー: staff_id → staffsテーブルのid
カラム:
id: integer
name: character varying
fiscal_month: integer
staff_id: integer
accounting_method: character varying
status: character varying
custom_tasks_by_year: jsonb
finalized_years: jsonb
created_at: timestamp without time zone
updated_at: timestamp without time zone

default_tasks
主キー: id
カラム:
id: integer
task_name: character varying
accounting_method: character varying
tasks: jsonb
display_order: integer
is_active: boolean
created_at: timestamp without time zone
updated_at: timestamp without time zone

editing_sessions
主キー: id
外部キー: client_id → clientsテーブルのid
カラム:
id: integer
client_id: integer
user_id: character varying
started_at: timestamp without time zone
last_activity: timestamp without time zone

monthly_tasks
主キー: id
外部キー: client_id → clientsテーブルのid
カラム:
id: integer
client_id: integer
month: character varying
tasks: jsonb
status: character varying
url: text
memo: text
created_at: timestamp without time zone
updated_at: timestamp without time zone

settings
主キー: key
カラム:
key: character varying
value: jsonb
created_at: timestamp without time zone
updated_at: timestamp without time zone

simple_test
主キー: id
カラム:
id: integer
name: text

staffs
主キー: id
カラム:
id: integer
name: character varying
email: character varying
role: character varying
created_at: timestamp without time zone
updated_at: timestamp without time zone

task_entries
主キー: id
外部キー: client_id → clientsテーブルのid
カラム:
id: integer
client_id: integer
month: character varying
tasks: jsonb
status: character varying
url: text
memo: text
created_at: timestamp without time zone
updated_at: timestamp without time zone


  🔐 認証・セキュリティ

  Google OAuth認証

  - 認証プロバイダー: Google OAuth 2.0
- 承認済みオリジン: https://jigyousya-final.vercel.app
  - セッション管理: Supabase Auth自動管理
  - ログイン頻度: 1日1回認証（自動セッション管理）

  Row Level Security (RLS)　まだ実装していない
  - データアクセス制御: Supabase RLS
  - 認証必須: 未ログイン時はデータアクセス不可
  - Anon Key: 公開（フロントエンド用、RLSで保護）

  🎯 主要機能

  1. クライアント管理

  - 一覧表示: 担当者別フィルター、検索機能
  - CRUD操作: 追加、編集、削除、再有効化
  - カスタムタスク設定: クライアント独自の項目設定
  - 年度確定機能: 特定年度のタスク項目ロック

  2. 月次進捗管理

  - 進捗入力: チェックボックス形式
  - ステータス表示:  自動計算: 完了率の自動算出　100％の場合は月次完了※月次完了で紙吹雪
  - URL・メモ: 各月次記録に付加情報
  -

  3. タスク項目管理

  - デフォルトタスク: 全クライアント共通の初期項目
  - カスタムタスク: クライアント別独自項目
  - 年度継承: 新年度アクセス時の前年度項目継承
  - タスク伝播: 項目変更時の未確定年度への反映

  4. 年度確定システム

  - 確定機能: 特定年度のタスク項目をロック
  - 編集制限: 確定済み年度は編集不可
  - 継承制御: 確定済み項目の新年度継承

  5. データ管理
※メイン画面にアコーディオンメニューにて以下の項目
  - CSVエクスポート: UTF-8 BOM付きExcel対応
  - CSVインポート: 複数エンコーディング対応
  - データベース初期化: 完全リセット機能

  6. 編集制御

  - 悲観ロック: 編集競合防止
  - 強制解除: 編集セッション強制終了
  - 自動タイムアウト: 一定時間後の自動解除

  🖥️ ユーザーインターフェース

  メイン画面

  - 検索バー: 事業所名・担当者名での絞り込み
  - フィルター: 担当者別、月別、ステータス別
  - 一覧表示: カード形式でクライアント情報表示
  - アコーディオンメニュー: 管理機能の統合UI

  管理メニュー

  📋 データ管理メニュー
  ├── 担当者管理
  ├── 顧問先追加
  ├── 基本設定
  ├── 項目の初期値の設定
  ├── 📊 CSVエクスポート
  ├── 📁 CSVインポート
  └── ⚠️ データベース初期化

  詳細・編集画面

  - 月次進捗表: 12ヶ月分の進捗管理
  - カスタムタスク設定: ドラッグ&ドロップ対応
  - 年度確定ボタン: 動的表示制御
  - 編集ロック表示: 編集中ユーザーの表示

  🔧 設定・カスタマイズ

  環境設定

  // Supabase設定（自動検出）
const SUPABASE_URL = 'https://lqwjmlkkdddjnnxnlyfz.supabase.co'
  const SUPABASE_ANON_KEY = '[自動設定]'

  // API設定（環境別自動切り替え）
  - 開発環境: localhost
  - 本番環境: Vercel自動検出

  カスタマイズ可能項目

  - デフォルトタスク項目: 基本設定から変更可能
  - 担当者リスト: 動的追加・編集
  - 年度設定: 会計年度に応じた自動調整
  - UI色調: CSS変数での一括変更

  📈 パフォーマンス

  速度改善

  - 初回アクセス: 0.5-1秒（従来の3-5秒から大幅改善）
  - コールドスタート: 完全解消（サーバーレス）
  - CDN配信: Vercel Edge Network
  - プリロード: 重要ファイルの事前読み込み

  スケーラビリティ

  - 同時接続: Supabaseの自動スケーリング
  - データ容量: PostgreSQL無制限（有料プラン）
  - API制限: Supabase無料枠内で運用

  🚀 デプロイメント

  自動デプロイ

  - トリガー: GitHubへのプッシュ
  - ビルド: Vercel自動ビルド
  - 反映時間: 1-2分
  - ロールバック: Git履歴からの即座復元

  環境管理

本番環境: https://jigyosyakanri2.vercel.app/index.html
  ├── フロントエンド: Vercel
  ├── データベース: Supabase
  ├── 認証: Google OAuth
  └── 監視: Vercel Analytics

  🔍 監視・保守

  ログ・監視

  - アクセスログ: Vercel Analytics
  - エラートラッキング: ブラウザコンソール
  - データベース: Supabase Dashboard
  - 認証ログ: Google Cloud Console

  バックアップ

  - コード: GitHub（自動バージョン管理）
  - データベース: Supabase自動バックアップ
  - 設定: リポジトリ内設定ファイル

  📋 今後の拡張予定

  検討中の機能

  - 通知システム: 期限アラート
  - レポート機能: 進捗レポート自動生成
  - モバイル対応: PWA化
  - APIキー管理: 外部システム連携

  技術的改良

  - TypeScript移行: 型安全性の向上
  - テスト自動化: 機能回帰テスト
  - CI/CD強化: 自動テスト・デプロイ
  - セキュリティ監査: 定期的なセキュリティチェック

