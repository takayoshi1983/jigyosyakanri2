 ğŸš€ TaskFlow for Accountants å®Ÿè£…è¨ˆç”»æ›¸ (æ”¹è¨‚ç‰ˆ)

  ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

  ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå: TaskFlow for Accountants (çµ±åˆé–‹ç™ºç‰ˆ)ç›®çš„:
  æ—¢å­˜ã€Œäº‹æ¥­è€…ç®¡ç†ã‚¢ãƒ—ãƒªã€ã®åŒä¸€DBç’°å¢ƒã§ã€è©³ç´°ãªã‚¿ã‚¹ã‚¯ç®¡ç†æ©Ÿèƒ½ã‚’çµ±åˆå®Ÿè£…é–‹ç™ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒ:
  æ—¢å­˜ã‚¤ãƒ³ãƒ•ãƒ©ã‚’æœ€å¤§æ´»ç”¨ã—ã€æ®µéšçš„æ©Ÿèƒ½æ‹¡å¼µã«ã‚ˆã‚‹çµ±åˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹ç¯‰

  ---
  ğŸ“‹ Step 1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µ (æ—¢å­˜DBæ´»ç”¨)

  1.1 æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ´»ç”¨ç¢ºèª

  - âœ… clients - äº‹æ¥­è€…æƒ…å ± (5ç¤¾ã®ãƒ‡ãƒ¼ã‚¿å­˜åœ¨)
  - âœ… staffs - æ‹…å½“è€…æƒ…å ± (æ—¢å­˜ãƒ‡ãƒ¼ã‚¿æ´»ç”¨)
  - âœ… èªè¨¼ãƒ»RLSã‚·ã‚¹ãƒ†ãƒ å®Œå‚™

  1.2 æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ 

  -- ã‚¿ã‚¹ã‚¯å„ªå…ˆåº¦ENUMå‹
  CREATE TYPE task_priority AS ENUM ('é«˜', 'ä¸­', 'ä½');

  -- ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¹ã‚¯ãƒ†ãƒ¼ãƒ–ãƒ«
  CREATE TABLE tasks (
      id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
      client_id INTEGER REFERENCES clients(id) ON DELETE SET NULL,
      staff_id INTEGER REFERENCES staffs(id), -- ä¾é ¼è€…
      assignee_id INTEGER REFERENCES staffs(id), -- å—ä»»è€…
      task_title TEXT NOT NULL,
      task_description TEXT,
      reference_url TEXT,
      estimated_time_hours NUMERIC(5, 2),
      actual_time_hours NUMERIC(5, 2),
      due_date DATE,
      status TEXT NOT NULL DEFAULT 'ä¾é ¼ä¸­'
          CHECK (status IN ('ä¾é ¼ä¸­', 'ä½œæ¥­ä¸­', 'ä½œæ¥­å®Œäº†', 'ç¢ºèªå®Œäº†')),
      priority task_priority DEFAULT 'ä¸­',
      created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
      updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
  );

  -- ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†
  CREATE TABLE task_templates (
      id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
      template_name TEXT NOT NULL UNIQUE,
      task_title TEXT NOT NULL,
      task_description TEXT,
      estimated_time_hours NUMERIC(5, 2),
      priority task_priority DEFAULT 'ä¸­',
      is_routine BOOLEAN DEFAULT FALSE,
      routine_day INT -- æ¯æœˆä½•æ—¥ã«ç”Ÿæˆã™ã‚‹ã‹
  );

  -- ã‚¿ã‚¹ã‚¯ã‚³ãƒ¡ãƒ³ãƒˆå±¥æ­´
  CREATE TABLE task_comments (
      id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
      task_id BIGINT NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,
      staff_id INTEGER REFERENCES staffs(id), -- staffsãƒ†ãƒ¼ãƒ–ãƒ«ã¨é€£æº
      comment TEXT NOT NULL,
      created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
  );

  -- RLSãƒãƒªã‚·ãƒ¼è¨­å®š
  ALTER TABLE tasks ENABLE ROW LEVEL SECURITY;
  CREATE POLICY "Authenticated users can manage tasks" ON tasks
      FOR ALL USING (auth.role() = 'authenticated');

  ALTER TABLE task_templates ENABLE ROW LEVEL SECURITY;
  CREATE POLICY "Auth users can manage task templates" ON task_templates
      FOR ALL USING (auth.role() = 'authenticated');

  ALTER TABLE task_comments ENABLE ROW LEVEL SECURITY;
  CREATE POLICY "Users can manage task comments" ON task_comments
      FOR ALL USING (auth.role() = 'authenticated');

  ---
  ğŸ¯ Step 2: çµ±åˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

  2.1 ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ–æ‹¡å¼µ

  æ—¢å­˜ã® analytics.html ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ‹¡å¼µï¼š
  <div class="tab-navigation">
      <a href="analytics.html" class="nav-tab dashboard">
          ğŸ“ˆ é€²æ—ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
      </a>
      <a href="tasks.html" class="nav-tab tasks">
          ğŸ“‹ ã‚¿ã‚¹ã‚¯ç®¡ç†
      </a>
      <a href="task-dashboard.html" class="nav-tab task-dashboard">
          ğŸ“Š ã‚¿ã‚¹ã‚¯åˆ†æ
      </a>
      <a href="performance.html" class="nav-tab performance">
          ğŸ‘¥ æ‹…å½“è€…åˆ¥é€²æ—
      </a>
      <a href="index.html" class="nav-tab settings">
          âš™ï¸ è¨­å®šç”»é¢
      </a>
  </div>

  2.2 å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ´»ç”¨

  - âœ… supabase-client.js - æ—¢å­˜APIæ´»ç”¨
  - âœ… toast.js - é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ç¶™æ‰¿
  - âœ… style.css - ãƒ‡ã‚¶ã‚¤ãƒ³çµ±ä¸€
  - âœ… custom-dropdown.css - UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæµç”¨

  ---
  ğŸ“ Step 3: ã‚¿ã‚¹ã‚¯ç®¡ç†ãƒ¡ã‚¤ãƒ³ç”»é¢å®Ÿè£… (tasks.html)

  3.1 é«˜æ©Ÿèƒ½ãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…

  // æ—¢å­˜analytics.jsã®æ‰‹æ³•ã‚’æµç”¨
  class TasksPage {
      constructor() {
          this.tasks = [];
          this.clients = []; // æ—¢å­˜clientsãƒ†ãƒ¼ãƒ–ãƒ«æ´»ç”¨
          this.staffs = [];  // æ—¢å­˜staffsãƒ†ãƒ¼ãƒ–ãƒ«æ´»ç”¨
          this.currentFilters = {
              assignee: '',
              client: '',
              status: '',
              priority: ''
          };
      }
  }

  3.2 è¡¨ç¤ºæ©Ÿèƒ½

  - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸: è‰²ä»˜ãè¡¨ç¤º (ä¾é ¼ä¸­=é’, ä½œæ¥­ä¸­=é»„, ä½œæ¥­å®Œäº†=ç·‘, ç¢ºèªå®Œäº†=ç°)
  - ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½: æ—¢å­˜analytics.htmlã®ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’æµç”¨
  - ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼: æ‹…å½“è€…ãƒ»äº‹æ¥­è€…ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ»å„ªå…ˆåº¦
  - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢: ã‚¿ã‚¹ã‚¯åãƒ»äº‹æ¥­è€…åã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢

  3.3 æ“ä½œæ©Ÿèƒ½

  - æ–°è¦ã‚¿ã‚¹ã‚¯è¿½åŠ : æ—¢å­˜ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’æµç”¨
  - ä¸€æ‹¬æ“ä½œ: ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹é¸æŠã§ã®æ‹…å½“è€…ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä¸€æ‹¬å¤‰æ›´
  - ç·¨é›†æ©Ÿèƒ½: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†ã¾ãŸã¯ãƒ¢ãƒ¼ãƒ€ãƒ«ç·¨é›†

  ---
  ğŸ“Š Step 4: ã‚¿ã‚¹ã‚¯åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å®Ÿè£… (task-dashboard.html)

  4.1 Chart.jsçµ±åˆ

  æ—¢å­˜ã®é€±æ¬¡é€²æ—ã‚°ãƒ©ãƒ•å®Ÿè£…ã‚’å‚è€ƒã«ï¼š
  // ã‚¿ã‚¹ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ¯”ç‡ (å††ã‚°ãƒ©ãƒ•)
  const statusChart = new Chart(ctx, {
      type: 'pie',
      data: {
          labels: ['ä¾é ¼ä¸­', 'ä½œæ¥­ä¸­', 'ä½œæ¥­å®Œäº†', 'ç¢ºèªå®Œäº†'],
          datasets: [{
              data: statusCounts,
              backgroundColor: ['#007bff', '#ffc107', '#28a745', '#6c757d']
          }]
      }
  });

  // æ‹…å½“è€…åˆ¥ã‚¿ã‚¹ã‚¯è² è· (æ£’ã‚°ãƒ©ãƒ•)
  const workloadChart = new Chart(ctx, {
      type: 'bar',
      data: staffWorkloadData
  });

  4.2 è¦æ³¨æ„ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ

  - æœŸé™åˆ‡ã‚Œã‚¿ã‚¹ã‚¯ (èµ¤è‰²ãƒã‚¤ãƒ©ã‚¤ãƒˆ)
  - æœ¬æ—¥æœŸé™ã‚¿ã‚¹ã‚¯ (ã‚ªãƒ¬ãƒ³ã‚¸è‰²ãƒã‚¤ãƒ©ã‚¤ãƒˆ)
  - é•·æœŸæ»ç•™ã‚¿ã‚¹ã‚¯ (ä½œæ¥­ä¸­3æ—¥ä»¥ä¸Š)

  ---
  ğŸ¨ Step 5: å¤šæ§˜ãªãƒ“ãƒ¥ãƒ¼ã®å®Ÿè£…

  5.1 ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆUI

  <div class="view-selector">
      <button class="view-btn active" data-view="table">ğŸ“‹ ãƒ†ãƒ¼ãƒ–ãƒ«</button>
      <button class="view-btn" data-view="board">ğŸ“Œ ãƒœãƒ¼ãƒ‰</button>
      <button class="view-btn" data-view="calendar">ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</button>
      <button class="view-btn" data-view="gantt">ğŸ“ˆ ã‚¬ãƒ³ãƒˆ</button>
  </div>

  5.2 å„ãƒ“ãƒ¥ãƒ¼ã®å®Ÿè£…

  ãƒœãƒ¼ãƒ‰ãƒ“ãƒ¥ãƒ¼ (ã‚«ãƒ³ãƒãƒ³)

  // SortableJSæ´»ç”¨ï¼ˆæ—¢å­˜analytics.htmlã§ä½¿ç”¨æ¸ˆã¿ï¼‰
  const sortable = Sortable.create(columnElement, {
      group: 'tasks',
      onEnd: async (evt) => {
          await updateTaskStatus(taskId, newStatus);
      }
  });

  ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼

  <!-- FullCalendar.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.0/index.global.min.js"></script>

  ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆãƒ“ãƒ¥ãƒ¼

  <!-- frappe-gantt CDN -->
  <script src="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.min.js"></script>

  ---
  ğŸ¤ Step 6: ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½

  6.1 ã‚³ãƒ¡ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ 

  // æ—¢å­˜toast.jsã‚’æ´»ç”¨ã—ãŸæŠ•ç¨¿é€šçŸ¥
  async function addTaskComment(taskId, comment) {
      const result = await SupabaseAPI.insertTaskComment(taskId, comment);
      if (result.success) {
          showToast('ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿ã—ã¾ã—ãŸ', 'success');
          refreshComments(taskId);
      }
  }

  6.2 ã‚¿ã‚¤ãƒ ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°

  class TimeTracker {
      startTimer(taskId) {
          this.startTime = Date.now();
          showToast('ä½œæ¥­æ™‚é–“ã®è¨ˆæ¸¬ã‚’é–‹å§‹ã—ã¾ã—ãŸ', 'info');
      }

      stopTimer(taskId) {
          const elapsedHours = (Date.now() - this.startTime) / (1000 * 60 * 60);
          return this.updateActualTime(taskId, elapsedHours);
      }
  }

  ---
  ğŸ”„ Step 7: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ»è‡ªå‹•åŒ–æ©Ÿèƒ½

  7.1 ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†

  æ—¢å­˜ã®åŸºæœ¬è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã«çµ±åˆï¼š
  // index.htmlã®ç®¡ç†ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«è¿½åŠ 
  <button id="task-templates-button" class="accordion-button">ğŸ“ ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</button>

  7.2 ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚¿ã‚¹ã‚¯è‡ªå‹•ç”Ÿæˆ

  -- Supabase Edge Function + pg_cron
  SELECT cron.schedule(
      'generate-routine-tasks',
      '0 9 * * *', -- æ¯æ—¥9:00ã«å®Ÿè¡Œ
      'SELECT generate_routine_tasks()'
  );

  ---
  ğŸ”— Step 8: æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æº

  8.1 é€²æ—ç®¡ç†ã¨ã®é€£æº

  // monthly_taskså®Œäº†æ™‚ã«ã‚¿ã‚¹ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
  async function onMonthlyTaskComplete(clientId, month) {
      // è©²å½“ã™ã‚‹è¨˜å¸³é–¢é€£ã‚¿ã‚¹ã‚¯ã‚’è‡ªå‹•çš„ã«ã€Œç¢ºèªå®Œäº†ã€ã«æ›´æ–°
      await SupabaseAPI.updateRelatedTasks(clientId, month, 'ç¢ºèªå®Œäº†');
  }

  8.2 ãƒ‡ãƒ¼ã‚¿åŒæœŸ

  - äº‹æ¥­è€…è¿½åŠ æ™‚â†’ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰åˆæœŸã‚¿ã‚¹ã‚¯ç”Ÿæˆ
  - æ‹…å½“è€…å¤‰æ›´æ™‚â†’é–¢é€£ã‚¿ã‚¹ã‚¯ã®æ‹…å½“è€…è‡ªå‹•æ›´æ–°

  ---
  ğŸ“± Step 9: ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤

  9.1 ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–

  æ—¢å­˜ã® style.css ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–è¨­å®šã‚’æ‹¡å¼µï¼š
  @media screen and (max-width: 768px) {
      .task-table { font-size: 12px; }
      .view-selector { flex-direction: column; }
  }

  9.2 Vercelçµ±åˆãƒ‡ãƒ—ãƒ­ã‚¤

  æ—¢å­˜ã® vercel.json è¨­å®šã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¿½åŠ ï¼š
  {
    "rewrites": [
      { "source": "/", "destination": "/analytics.html" },
      { "source": "/tasks", "destination": "/tasks.html" },
      { "source": "/task-dashboard", "destination": "/task-dashboard.html" }
    ]
  }

  ---
  ğŸ¤– Step 10: AIæ©Ÿèƒ½æº–å‚™ (ãƒ•ã‚§ãƒ¼ã‚º2)

  10.1 APIæº–å‚™

  // ãƒ€ãƒŸãƒ¼é–¢æ•°å®Ÿè£…
  async function suggestOptimalAssignee(taskData) {
      // Gemini APIé€£æºæº–å‚™
      return { suggestedStaffId: null, confidence: 0 };
  }

  async function generateMonthlyReport(completedTasks) {
      // å ±å‘Šæ›¸ç”Ÿæˆæº–å‚™
      return { reportDraft: '', generatedAt: new Date() };
  }

  ---
  ğŸ“… å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

  | Phase | å†…å®¹           | æ¨å®šæ™‚é–“ |
  |-------|--------------|------|
  | 1     | DBæ‹¡å¼µãƒ»ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ | 2æ™‚é–“  |
  | 2     | ã‚¿ã‚¹ã‚¯ç®¡ç†åŸºæœ¬ç”»é¢    | 4æ™‚é–“  |
  | 3     | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å®Ÿè£…    | 3æ™‚é–“  |
  | 4     | å¤šæ§˜ãªãƒ“ãƒ¥ãƒ¼å®Ÿè£…     | 6æ™‚é–“  |
  | 5     | ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½   | 3æ™‚é–“  |
  | 6     | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ»è‡ªå‹•åŒ–   | 4æ™‚é–“  |
  | 7     | é€£æºãƒ»æœ€çµ‚èª¿æ•´      | 2æ™‚é–“  |
  | åˆè¨ˆ    |              | 24æ™‚é–“ |

  ---
  ğŸ¯ æˆåŠŸæŒ‡æ¨™

  1. æ©Ÿèƒ½å®Œæˆåº¦: æŒ‡å›³æ›¸ã®å…¨æ©Ÿèƒ½å®Ÿè£…å®Œäº†
  2. æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ: ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿç¾
  3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: æ—¢å­˜ã‚¢ãƒ—ãƒªã¨åŒç­‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç¶­æŒ
  4. ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£: ç›´æ„Ÿçš„ãªæ“ä½œæ€§ç¢ºä¿